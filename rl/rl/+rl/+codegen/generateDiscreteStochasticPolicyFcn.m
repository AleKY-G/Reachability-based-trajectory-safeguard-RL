function argStruct = generateDiscreteStochasticPolicyFcn(argStruct,finiteSetSpec)
% GENERATEDISCRETESTOCHASTICPOLICYFCN generates discrete stochastic policy
% (use for PG, AC, etc. agents)

% Copyright 2019 The MathWorks, Inc.

% REVISIT: should this method live in sampling strategy?

outputstr    = argStruct.OutputString;
inputstr     = argStruct.InputString ;
outputstr_y  = rl.codegen.handleMultipleOutputStrings(outputstr);

[elementstr,IL,IR] = rl.codegen.generateFiniteElementStrings(finiteSetSpec);
argStruct.EvaluateFunctionName = 'localEvaluate';

bodystr = sprintf([...
    'actionSet = %s;\n',...
    '%% Select action from sampled probabilities\n',...
    'probabilities = localEvaluate(%s);\n',...
    '%% Normalize the probabilities\n',...
    'p = probabilities(:)''/sum(probabilities);\n',...
    '%% Determine which action to take\n',...
    'edges = min([0 cumsum(p)],1);\n',...
    'edges(end) = 1;\n',...
    '[~,actionIndex] = histc(rand(1,1),edges); %%#ok<HISTC>\n',...
    '%s = actionSet%sactionIndex%s;'],...
    elementstr,...
    inputstr,...
    outputstr_y,IL,IR...
    );
argStruct.EvaluateOutputString = 'probabilities';
argStruct.BodyString = bodystr;